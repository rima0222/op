<script>
    async function refreshStats() {
        try {
            const res = await fetch('/api/stats');
            const data = await res.json();
            
            document.getElementById('total-users').innerText = data.total_users;
            document.getElementById('online-users').innerText = data.online_users;

            const tbody = document.querySelector('tbody');
            tbody.innerHTML = ''; 

            data.users_list.forEach(user => {
                tbody.innerHTML += `
                    <tr class="hover:bg-white/5 transition-colors border-b border-white/5">
                        <td class="p-4 font-medium text-purple-300">${user.username}</td>
                        <td class="p-4 text-sm text-gray-400">${user.usage}</td>
                        <td class="p-4 text-sm text-gray-400">${user.expiry} روز باقی‌مانده</td>
                        <td class="p-4">
                            <span class="${user.status === 'Online' ? 'text-green-400 bg-green-400/10' : 'text-gray-500 bg-white/5'} px-3 py-1 rounded-full text-xs animate-pulse">
                                ${user.status}
                            </span>
                        </td>
                        <td class="p-4 flex gap-4">
                            <a href="/api/download/${user.username}" class="text-blue-400 hover:text-blue-200 transition-all font-bold">⬇ دانلود کانفیگ</a>
                            <button class="text-red-500 hover:text-red-300">حذف</button>
                        </td>
                    </tr>
                `;
            });
        } catch (e) { console.log("Error fetching stats..."); }
    }
    setInterval(refreshStats, 5000); 
    refreshStats();
</script>
